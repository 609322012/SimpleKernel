# FAQ

1. **物理地址、逻辑地址、有效地址、线性地址、虚拟地址区别**

   **物理地址**就是物理内存真正的地址，相当于内存中每个存储单元的门牌号，具有唯一性。不管在什么模式下，不管什么虚拟地址、线性地址， CPU 最终都要以物理地址去访问内存，只有物理地址才是内存访问的终点站。
   实模式下，“段基址＋段内偏移地址”经过段部件的处理，直接输出的就是物理地址， CPU 可以直接用此地址访问内存 。
   在保护模式下，＂段基址＋段内偏移地址”称为**线性地址**，不过，此时的段基址已经不再是真正的地址了，而是一个称为选择子的东西 。 它本质是个索引，类似于数组下标，通过这个索引便能在 GDT 中找到相应的段描述符，在该描述符中记录了该段的起始、大小等信息，这样便得到了段基址。若没有开启地址分页功能，此线性地址就被当作物理地址来用，可直接访问内存。 若开启了分页功能，此线性地址又多了一个名字，就是**虚拟地址** （虚拟地址、线性地址在分页机制下都是一回事） 。 虚拟地址要经过 CPU 页部件转换成具体的物理地址，这样 CPU 才能将其送上地址总线去访问内存。
   无论在实模式或是保护模式下，段内偏移地址又称为**有效地址**，也称为**逻辑地址**，这是程序员可见的地址 。 这是因为，最终的地址是由段基址和段内偏移地址组合而成的。由于段基址已经有默认的啦，要么是在实模式下的默认段寄存器中，要么是在保护模式下的默认段选择子寄存器指向的段描述符中，所以只要给出段内偏移地址就行了，这个地址虽然只是段内偏移，但加上默认的段基址，依然足够有效 。
   线性地址或称为虚拟地址，这都不是真实的内存地址。它们都用来描述程序或任务的地址空间 。 由于分页功能是需要在保护模式下开启的， 32 位系统保护模式下的寻址空间是 4GB，所以虚拟地址或线性地址就是 0～4GB 的范围 。

![address mode](.\images\address mode.png)



2. **什么是平坦模式**

   平坦模型是相对于多段模型来说的，所以说平坦模型指的就是一个段 。 比如在实模式下，访问超过64KB 的内存，需要重新指定不同的段基址，通过这种迂回变通的方式才能达到目的。在保护模式下，由于其是 32 位的，寻址范围便能够达到 4GB ，段内偏移地址也是地址，所以也是 32 位 。 可见，在 32位环境下用一个段就能够访问到硬件所支持的所有内存 。 也就是说，段的大小可以是地址总线能够到达的范围 。 既然平坦模型是相对于多段模型来说的，为什么不称为单段模型，而称为平坦昵，我估计很多读者己经明白了，用多个小段再加上不断换段基址的方式访问内存确实够麻烦的，可能换着换着就晕了，别忘记了，这种多段模型为了访问到 l MB 地址空间，还需要额外打开 A20 地址线昵，这种访存方式本身就是种补救措施，相当于给硬件打了个补丁，既然是补丁，访问内存的过程必然是不顺畅的 。 相对于那么麻烦的多段模型，平坦模型不需要额外打开 A20 地址线，不需要来回切换段基址就可以在地址空间内任意朝翔。如果把内存段比喻成小格子的话，平坦模型下的内存访问，没有众多小格子成为羁绊，可谓一路“平坦”。
   所以“平坦”这两个字，突显了 当时的程序员受多段模型折磨之苦，迫不及待地想表达其优势的喜悦之情。  

**Reference：**

​	操作系统真相还原 郑钢 2016