# 文件系统

如下图所示，为一个传统的计算机文件存储结构，可以看到我们一般最直接感受到的硬盘disk所处的位置相对是最靠后的， 也是本地存储的最后一级，能够存储大量的内容，但是其读取效率并不高。

<img src=".\images\memory hierachy.jpg" alt="IO general" style="zoom:95%;" />



而文件系统主要负责管理我们的磁盘，我们大多数的文件数据都存储在磁盘中，磁盘是一个能够存储数量巨大，但是进行读取速度十分缓慢的设备。为此在一般情况下我们需要避免频繁的对磁盘进行访问，以减少我们系统正常的运行速度。我们需要当数据积攒够到一定大小后进行一次访问，进行整存整取，我们称之为块。在磁盘中的读取单元为扇区，而一个块会对应于多个扇区，块大小一般为扇区的整数倍。

我们常见的文件系统主要包括有FAT、NTFS以及UNIX的文件系统。在windows重要使用FAT和NTFS格式，这两种格式均是采用链式的结构进行组织，将文件通过链表进行存储，比如件 A 大小是 10KB，块大小是 4KB，因此要占用3 个块，最后一个块中浪费了 2KB空间。 通过链式结构来组织文件的弊端是当访问文件中的某个块时，必须要从头开始遍历块结点，每访问一个结点，就要涉及一次硬盘寻道，使得对原本低速的设备访问更加频繁了  ,所以后来微软推出了NTFS格式。

而在UNIX中主要采用的是索引结构来进行组织，避免了访问某一数据块需要从头把其前所有数据块再遍历一次的缺点。采用索引结构的文件系统，文件中的块可以分散到不连续的零散空间中，保留了磁盘高利用率的优点，更重要的是文件系统为每个文件的所有块建立了一个索引表，索引表就是块地址数组，每个数组元素就是块的地址，如且元素下标是文件块的索引，第 n 个数组元素指向文件中的第 n 个块，这样访问任意一个块的时候，只要从索引表中获得块地址就可以了，速度大大提升。包含此索引表的索引结构称为 inode，即 index node，索引结点，用来索引、跟踪一个文件的所有块。强调下， inode 是文件索引结构组织形式的具体体现，必须为每个文件都配备一个这样的元信息数据结构，因此在UINX 文件系统中，一个文件必须对应一个inode，磁盘中有多少文件就有多少 inode。而在文件系统的开始，会有一个叫做super block 超级块来进行inode等一些相关结构的管理。

在linux中也是参考了unix的实现方式，同样使用索引结构来进行文件管理，其中ext2,ext3,ext4是linux中进行文件管理的文件系统。

